<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

    <!-- jQuery library -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <!-- Latest compiled JavaScript -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

    <!-- Vue compiled Javascript library-->
    <script src="https://cdn.jsdelivr.net/npm/vue@2/dist/vue.js"></script>

    <!-- Mustache compiled JavaScript and Jquery Library-->
    <script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mustache.js/2.3.0/mustache.min.js"></script>
    
    <style>
        .scrollable-menu {
            height: auto;
            max-height: 200px;
            overflow-x: hidden;
        }
    </style>

    <title>Senate Data</title>
</head>
<body>
    <div class = "container">
        <ul class="nav navbar-nav">
            <li><img src = "../img/tgif_logo.jpg" alt = "Site logo" href="index.html" width ="25%" height = "25%"></li>        
        </ul>
        <ul class="nav navbar-nav navbar-right"><br><br>
            <li><span class="glyphicon glyphicon-envelope"><a target="_blank" rel="nofollow noreferrer noopener" 
                href="mailto:info@tgif.net"> info@tgif.net &ensp;</a></span></li>
        </ul>
    </div>
            
    <nav class="navbar navbar-inverse container">  
        <div class="container-fluid">
            <div class="navbar-header">
                <ul class="nav navbar-nav">
                    <li><a href="index.html">Home</a></li>
                    <li class="dropdown active"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Congress 113 <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li class="active"><a href="senate-data.html">Senate</a></li>
                            <li><a href="house-data.html">House</a></li>

                        </ul>
                    </li>                    
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Attendance <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="senate-attendance.html">Senate</a></li>
                            <li><a href="house-attendance.html">House</a></li>
                        </ul>
                    </li>
                    <li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown" href="#">Party Loyalty <span class="caret"></span></a>
                        <ul class="dropdown-menu">
                            <li><a href="senate-party-loyalty.html">Senate</a></li>
                            <li><a href="house-party-loyalty.html">House</a></li>
                        </ul>
                    </li>
                    <li class="dropdown" id = "States-drp"><a class="dropdown-toggle" data-toggle="dropdown" href="#">State Legislators <span class="caret"></span></a>
                        <ul class="dropdown-menu scrollable-menu">
                            <!--<li><a href="washington-legislator.html">Washington State Legislators</a></li>-->
                            <script id = "Legislator-state-template" type = "text/template">
                                {{#states}}
                                <li><a href="legislator.html?state={{State Name}}">{{State Name}} Legislators</a></li>
                                {{/states}}
                            </script>
                        </ul>
                    </li>
                </ul>
            </div>
        </div>
    </nav>        

    <!--<header>   
        <div>
        </div>
    </header>-->

    <!--Table container-->
    <div  class="container">
        <h2>Senators</h2>
        <p>First convened in 1789, the composition and powers of the Senate are established in Article One of the U.S. Constitution. 
            Each state is represented by two senators, regardless of population, who serve staggered six-year terms. 
            The Senate has several exclusive powers not granted to the House, including consenting to treaties as a precondition to their 
            ratification and consenting to or confirming appointments of Cabinet secretaries, federal judges, other federal executive officials, 
            military officers, regulatory officials, ambassadors, and other federal uniformed officers, as well as trial of federal officials 
            impeached by the House.</p> <br>
            <ul class="nav navbar-nav">
                
                <li><p><label>Filter by Party:  &emsp;</label> 
                    <input type="checkbox" id="Rep" name="party1" value="Republican" checked><label for="party1"> &nbsp;Republican &nbsp;</label>                   
                    <input type="checkbox" id="Dem" name="party2" value="Democrat" checked><label for="party2"> &nbsp;Democrat &nbsp;</label>
                    <input type="checkbox" id="Ind" name="party3" value="Independent" checked><label for="party3"> &nbsp;Independent</label>
                    </p></li>        
            </ul>
            <ul class="nav navbar-nav navbar-right " >
                <li><p><label class = "dropdown">Filter by State: </label></p> </li>
                <li class="dropdown show btn-group btn-sm" id = "myList"></li>
               <!-- <select id = "myList">
                    
                    <option value = "1">one</option>
                    <option value = "2">two</option>
                    <option value = "3">three</option>
                    <option value = "4">four</option> 
                </select>-->
                
            </ul>
        <!-- Data representation starts-->
        <table id = "senate_data" width = "100%">
            <table id= "senateTable" class = "table table-hover">
                <thead> 
                    <tr>
                        <td> Name </td>
                        <td> Party </td>
                        <td> State </td>
                        <td> Years in Office </td>
                        <td> % Votes w/ Party </td>
                    </tr>
                </thead>
                <tbody id= "senatebody">
                    <tr v-for = "senators in smembers">
                        <td> <a v-bind:href = " senators.url "  target = "_blank">{{ senators.first_name}}  {{ senators.last_name}} </a>  </td>
                        <td> {{ senators.party }} </td>
                        <td> {{ senators.state }} </td>
                        <td> {{ senators.seniority }} </td>
                        <td> {{ senators.votes_with_party_pct }} %  </td>
                    </tr>
                </tbody>
            </table>
         
        </table>
        
        <!--<script src= "../Data/pro-congress-113-senate.js">   </script>-->
       <!--<script src = "../Data/senate_main.js"> </script>-->   <!-- Include this only when fetching data with xml http request -->

        <script>       
            var senate_members = [];
            //document.getElementById("senate-data").innerHTML = JSON.stringify(data,null,2);
            fetch('https://api.propublica.org/congress/v1/113/senate/members.json', 
            {
                method: "GET", headers: {"X-API-Key": "UhF33HiFCqKhPyblkLJpAdAL4Yrqf459nGgmTE52",}
            })
            .then(response => response.json())
            .then(function(data)
            {
                senate_members = data.results[0].members;  //not replacing members with members1 since lot of changes required in code
                //Adding code to display data using Vue.js
                var app4 = new Vue({
                    el: '#senatebody',
                    data: {
                        smembers: senate_members
                    }
                })
                var all_states = [];
                for(var vals of senate_members)
                {   
                    //console.log(vals);
                    var senate_keys = Object.keys(vals);
                    var senate_values = Object.values(vals);
                    //console.log("The senate keys are: " + senate_keys);

                    all_states.push(vals.state);
                
                }
                //Creating an array of all the states of the data table, adding a default value to the state array and sorting it.
                console.log(all_states);
                var unique_states = [];
                unique_states = all_states.filter((item, i, ar) => ar.indexOf(item) === i);
                unique_states.push("-- All States --");
                unique_states.sort();
                console.log("unique states are:  " + unique_states);
           
                var states = document.createElement("select");
                states.id = "state_drp";                            //id of dynamically created state drop down
                //states.setAttribute( "onchange", "filterparty()");
                for(const drp of unique_states)
                {
                    var optn = document.createElement("option");
                    optn.value = drp;
                    optn.text = drp;
                    states.appendChild(optn);
                }
                //binding the dynamic drop to the dropdown list of html thereby setting default index.
                document.getElementById("myList").appendChild(states).selectedIndex=unique_states[0];

            })
            
        </script>

        <script>
            //function for onchange event of checkboxes.
            function filterparty()
            {
                var state_obj = document.getElementById('state_drp');
                var state_value = state_obj.options[state_obj.selectedIndex].value;
                console.log(state_obj, state_value);
                var filtered_senators = [];
                var s_mem = [];
                s_mem = data.results[0].members;
                console.log(s_mem);
                for(var i =0; i < s_mem.length;i++)
                {
                    if(state_value == "-- All States --")
                    {
                        if ((document.getElementById("Rep").checked === true) && (s_mem[i].party === "R"))
                            filtered_senators.push(s_mem[i]);
                        if ((document.getElementById("Dem").checked === true) && (s_mem[i].party === "D"))
                            filtered_senators.push(s_mem[i]);
                        if ((document.getElementById("Ind").checked === true) && (s_mem[i].party === "ID"))
                            filtered_senators.push(s_mem[i]);                   
                    }
                    else
                    {
                        if ((document.getElementById("Rep").checked === true) && (s_mem[i].party === "R") && (s_mem[i].state === state_value))
                            filtered_senators.push(s_mem[i]);
                        if ((document.getElementById("Dem").checked === true) && (s_mem[i].party === "D") && (s_mem[i].state === state_value))
                            filtered_senators.push(s_mem[i]);
                        if ((document.getElementById("Ind").checked === true) && (s_mem[i].party === "ID") && (s_mem[i].state === state_value))
                            filtered_senators.push(s_mem[i]);
                    }
                }
                console.log(filtered_senators);
                var table2 = document.getElementById("senateTable");
                var old_body = document.getElementById("senatebody");

                var body2 = table2.createTBody();
                body2.setAttribute("id", "senatebody");
                var senate_row2 = body2.insertRow(-1);
                
                for(var vals of filtered_senators)
                {   
                    //console.log(vals);
                    var senate_keys = Object.keys(vals);
                    var senate_values = Object.values(vals);
                    //console.log("The senate keys are: " + senate_keys);

                    senate_row2 = table2.insertRow(-1);
                    var senate_header = ["senate_data_fullname", "senate_data_party", "senate_data_state", "senate_data_seniority", "senate_data_votes_with_party_pct"];
                    
                    //Task 6 - Hyperlink Name
                    var namelink = "<a href=" + '"' + vals.url + '"' +  "target=" + '"' + "_blank" + '"' + ">" + [vals.first_name, vals.last_name].join(" ") + "</a>" ;
                    var senate_cellValues = [namelink , vals.party, vals.state, vals.seniority, [vals.votes_with_party_pct, "%"].join(" ")];
                    
                    senate_header.forEach(myFunction);
                                
                    function myFunction(item, index)
                    {
                        senate_row2.insertCell(-1).innerHTML = senate_cellValues[index]; 
                    } 
                }
                old_body.parentNode.replaceChild(body2, old_body);

            }
            var chkb1 = document.getElementById("Rep");
            chkb1.addEventListener("change", filterparty, false);

            var chkb2 = document.getElementById("Dem");
            chkb2.addEventListener("change", filterparty, false);

            var chkb3 = document.getElementById("Ind");
            chkb3.addEventListener("change", filterparty, false);

            var drpdn1 = document.getElementById("state_drp");
            drpdn1.addEventListener("change", filterparty, false);

        </script>

        <script src = "/TGIF project/task5/model/all_states.js"></script>
        <script src = "../JS-AJAX/utilities.js"></script>
        
        <div class="footer-basic text-center p-3" style="background-color: rgba(0, 0, 0, 0.2);">
            <footer>  <p><strong>Â© 2016 TGIF | All Rights Reserved.</strong></p></footer>
        </div>
    </div>
</body>
</html>